#!/soft/bin/perl

# An example script demonstrating the use of BioMart API.
# This perl API representation is only available for configuration versions >=  0.5 
use strict;
use BioMart::Initializer;
use BioMart::Query;
use BioMart::QueryRunner;

my $confFile = "Pipeline/includes/BioMart_registry";
#
# NB: change action to 'clean' if you wish to start a fresh configuration  
# and to 'cached' if you want to skip configuration step on subsequent runs from the same registry
#

my $action='cached';
my $initializer = BioMart::Initializer->new('registryFile'=>$confFile, 'action'=>$action);
my $registry = $initializer->getRegistry;

my $query = BioMart::Query->new('registry'=>$registry,'virtualSchemaName'=>'default');

		
	$query->setDataset("hsapiens_gene_ensembl");
	$query->addFilter("ensembl_transcript_id", ["ENST00000470347","ENST00000455385","ENST00000541407","ENST00000304434","ENST00000243253","ENST00000424880","ENST00000468323","ENST00000481767","ENST00000421089","ENST00000400259","ENST00000336865","ENST00000242576","ENST00000327858","ENST00000262722","ENST00000452790","ENST00000409600","ENST00000439640","ENST00000400137","ENST00000348108","ENST00000293422","ENST00000377855","ENST00000377860","ENST00000398409","ENST00000376925","ENST00000393065","ENST00000262294","ENST00000544658","ENST00000538446","ENST00000537543","ENST00000540275","ENST00000312469","ENST00000304332","ENST00000402434","ENST00000317610","ENST00000251527","ENST00000275418","ENST00000415618","ENST00000452673","ENST00000543697","ENST00000456697","ENST00000420430","ENST00000248975","ENST00000407327","ENST00000335757","ENST00000335972","ENST00000377271","ENST00000529307","ENST00000341394","ENST00000331817","ENST00000422319","ENST00000431221","ENST00000311893","ENST00000519831","ENST00000260102","ENST00000360830","ENST00000372360","ENST00000510902","ENST00000395719","ENST00000465271","ENST00000366856","ENST00000440114","ENST00000345042","ENST00000440191","ENST00000425053","ENST00000524951","ENST00000340006","ENST00000366816","ENST00000366815","ENST00000392312","ENST00000367651","ENST00000344824","ENST00000300933","ENST00000405570","ENST00000396185","ENST00000444805","ENST00000430350","ENST00000542304","ENST00000315436","ENST00000435246","ENST00000439696","ENST00000392623","ENST00000392622","ENST00000356978","ENST00000447653","ENST00000534920","ENST00000375635","ENST00000441461","ENST00000296122","ENST00000541407","ENST00000304434","ENST00000243253","ENST00000424880","ENST00000336865","ENST00000242576","ENST00000452790","ENST00000409600","ENST00000348108","ENST00000293422","ENST00000377855","ENST00000377860","ENST00000398409","ENST00000376925","ENST00000521545","ENST00000378722","ENST00000393065","ENST00000262294","ENST00000429377","ENST00000525681","ENST00000312469","ENST00000304332","ENST00000402434","ENST00000317610","ENST00000371269","ENST00000539536","ENST00000420430","ENST00000248975","ENST00000407327","ENST00000335757","ENST00000335972","ENST00000377351","ENST00000341712","ENST00000395811","ENST00000527226","ENST00000379060","ENST00000529307","ENST00000341394","ENST00000331817","ENST00000422319","ENST00000543827","ENST00000374383","ENST00000519831","ENST00000260102","ENST00000544551","ENST00000343115","ENST00000330923","ENST00000374087","ENST00000360830","ENST00000372360","ENST00000407086","ENST00000340746","ENST00000439749","ENST00000369026","ENST00000286788","ENST00000542732","ENST00000440191","ENST00000425053","ENST00000524951","ENST00000340006","ENST00000445896","ENST00000440951","ENST00000392312","ENST00000367651","ENST00000518055","ENST00000297338","ENST00000344824","ENST00000300933","ENST00000382300","ENST00000426305","ENST00000455635","ENST00000361566","ENST00000444805","ENST00000430350","ENST00000310706","ENST00000393931","ENST00000373833","ENST00000373832","ENST00000435246","ENST00000439696","ENST00000392623","ENST00000392622","ENST00000361007","ENST00000535856","ENST00000526580","ENST00000397736"]);
	$query->addAttribute("ensembl_gene_id");
	$query->addAttribute("ensembl_transcript_id");
	$query->addAttribute("external_gene_id");
	$query->addAttribute("peptide");

#$query->formatter("TSV");
$query->formatter("FASTA");

my $query_runner = BioMart::QueryRunner->new();
############################## GET COUNT ############################
# $query->count(1);
# $query_runner->execute($query);
# print $query_runner->getCount();
#####################################################################


############################## GET RESULTS ##########################
# to obtain unique rows only
# $query_runner->uniqueRowsOnly(1);

$query_runner->execute($query);
$query_runner->printHeader();
$query_runner->printResults();
$query_runner->printFooter();
#####################################################################